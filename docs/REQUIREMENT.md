# 学級通信 AI アシスタント

## ― ゆとり職員室  要件定義書（改訂版）

*Google Cloud Japan AI Hackathon Vol.2 提出フォーマット / 非エンジニア向け*

---

### 0. 変更点ハイライト

| 追加要求                            | 反映箇所                     |
| ------------------------------- | ------------------------ |
| **快適な音声入力**・超シンプル辞書             | 3.1 機能要件①②／7.1 STT モジュール |
| **ワンタッチ「リライト」& カスタム指示**         | 3.1 機能要件③④／5.2 編集画面      |
| **AI 見出し生成・季節カラーパレット**          | 3.1 機能要件⑤⑥               |
| **レイアウト全まかせボタン／グラレコ風**          | 3.1 機能要件⑦⑧               |
| **静止画⇔インタラクティブ切替**              | 3.1 機能要件⑨                |
| **PDF・Drive・Classroom・LINE 通知** | 3.1 機能要件⑩                |
| **月別フォルダ管理 & Done 処理**          | 3.1 機能要件⑪                |
| **スライドショー＋AI ナレーション (挑戦枠)**     | 3.1 拡張機能 *Optional*      |

---

## 1. プロジェクト概要

### 1.1 名称

**ゆとり職員室（Yutori Staff-room）**

### 1.2 目的

* 毎週 2–3 h かかる学級通信を **20 分以内** で完成
* 先生の残業を削減し、子どもと向き合う「ゆとり」を増やす

### 1.3 背景・課題

| 困りごと        | 現状            | 影響       |
| ----------- | ------------- | -------- |
| 手入力が大変      | タイピング＋レイアウト地獄 | 残業/月45 h |
| 情報過多で読まれない  | 長文PDF＆紙配布     | 保護者閲覧率↓  |
| カラー統一・見出し作成 | 毎回デザインを考える    | 時間とストレス  |
| 帰国子女・多文化対応  | 翻訳なし          | 情報格差     |

---

## 2. ステークホルダー

| 区分   | ゴール       | ペイン        |
| ---- | --------- | ---------- |
| 担任教師 | 最短で通信作成   | 原稿・レイアウト作業 |
| 教務主任 | 学年通信取りまとめ | 版管理が煩雑     |
| 保護者  | 必要情報だけ欲しい | 長文で読まない    |

---

## 3. システム要件

### 3.1 機能要件

| #                                  | MVP 基本機能                                                      | 説明 |
| ---------------------------------- | ------------------------------------------------------------- | -- |
| ① 快適**音声入力**                       | Google Speech-to-Text＋**ノイズ抑制**｜ワンタップ録音／リアルタイム字幕              |    |
| ② **ユーザー辞書**                       | キーワードのみ登録（カテゴリ不要）→ STT で固有名詞を正確変換                             |    |
| ③ **リライトボタン**                      | Gemini で文体クリーニング（句読点・敬語調整）                                    |    |
| ④ **カスタム指示**                       | 「やさしい語り口」「学年主任らしい口調」などワンフレーズで反映                               |    |
| ⑤ **AI 見出し生成**                     | 入力文をトピック分割し、適切な見出し候補を提示                                       |    |
| ⑥ **季節カラーパレット**                    | 春・夏・秋・冬の 4 系統から自動トーン調整                                        |    |
| ⑦ **レイアウト全まかせ**                    | 話題ジャンルごとに最適配置／"まかせる"ボタンで即反映                                   |    |
| ⑧ **HTMLベースWYSIWYGエディタ**              | リアルタイム編集可能なHTML通信作成（ドラッグ&ドロップ対応）                              |    |
| ⑨ **チャットベースAI編集**                   | 対話形式でテキスト修正・デザイン調整（差分表示・提案受諾/拒否）                             |    |
| ⑩ **グラレコ風テンプレート**                   | 手描き風アイコン・吹き出し・イラスト素材を標準搭載                                     |    |
| ⑪ **静止画⇔インタラクティブ切替**               | PDF モード / HTML＋アニメ GIF（Lottie）モード                             |    |
| ⑫ **出力・配信**                        | PDF 生成（Cloud Functions）／Drive 保存／Classroom 投稿（LINE 通知 ON/OFF） |    |
| ⑬ **履歴管理**                         | Cloud Storage に月別フォルダ自動振り分け＋「完了 (Done)」ボタン                    |    |
| ⑭ *Optional* **スライドショー＋AI ナレーション** | 画像⇆音声で自動スライド、Text-to-Speech で朗読                               |    |

#### 3.1.2 拡張機能（フェーズ 2+）

* 多言語自動翻訳（英・中 など）
* 学年通信／通信簿コメント生成
* 閲覧率ダッシュボード（BigQuery + Looker)

### 3.2 非機能要件

| 軸        | 目標値                            |
| -------- | ------------------------------ |
| UX       | 3 画面以内・5 タップ完結                 |
| 表示速度     | 主要操作応答 < 500 ms                |
| セキュリティ   | 児童データ暗号化＋権限分離                  |
| 可用性      | 99.5 %（App Engine / Cloud Run） |
| アクセシビリティ | フォント拡大・高コントラスト                 |

---

## 4. システム構成

### 4.1 技術スタック（ハッカソン要件適合）

| 層        | サービス                                                                                            | 採用理由               |
| -------- | ----------------------------------------------------------------------------------------------- | ------------------ |
| フロント     | **Flutter Web** on Firebase Hosting                                                             | 単一コードで Web/モバイル両対応 |
| API /BFF | **Cloud Run** (FastAPI)                                                                         | スケール自動・GCR CI/CD   |
| AI       | **Vertex AI (Gemini 1.5 Pro)** ― Re-write/Heading/Layout<br>**Speech-to-Text / Text-to-Speech** | 必須 AI 技術／音声双方向     |
| ストレージ    | **Cloud Storage** (PDF・画像)、**Firestore** (メタ)                                                   | 月別フォルダ管理／リアルタイム DB |
| Task     | **Cloud Functions** (PDF 生成、Drive Sync)                                                         | 軽量バッチ              |
| 配信       | **Google Classroom API**、**LINE Messaging API**                                                 | 学校標準＋保護者利便性        |
| Auth     | **Firebase Authentication**                                                                     | Google/SNS ログイン    |
| その他      | Cloud Logging / Error Reporting                                                                 | 運用監視               |

### 4.2 構成図（簡略版）

```
Flutter Web (PC/スマホ)
   │録音/操作
   ▼
Cloud Run (FastAPI) ── Gemini / STT / TTS
   │生成 /変換
   ├─ Cloud Storage (PDF・画像 月別)
   ├─ Firestore (記事メタ)
   └─ Cloud Functions (PDF生成⇆Drive)
        │
        ├─ Classroom Post
        └─ LINE Notify (option)
```

---

## 5. 画面・機能仕様（3 画面集約）

| 画面            | 主UI                                             | 主要ボタン                                   |
| ------------- | ----------------------------------------------- | --------------------------------------- |
| **① ダッシュボード** | 過去通信カード＋「＋新規」                                   | 新規作成・履歴Done                             |
| **② エディタ**    | 左：音声入力＋見出し候補<br>中央：HTMLベース グラレコ WYSIWYG<br>右：AIチャット編集＋プレビュー／配信設定 | 録音・リライト・カスタム指示・全まかせ・素材挿入・チャット編集・PDF/Drive/Classroom |
| **③ 設定**      | ユーザー辞書・Drive 連携・LINE 通知 ON/OFF                  | CSV取込・再認証                               |

*モーダル*：写真選択、配信プレビュー、静止画/インタラクティブ切替

## 5.1 エディタ画面詳細仕様

### 5.1.1 AIチャット編集パネル（右サイドバー）

**機能一覧：**
- **リアルタイム対話編集** - 「この部分をもっと丁寧に」「もう少し短く」等の自然言語指示
- **差分表示機能** - 変更前後を色分けハイライト（緑：追加／赤：削除／黄：修正）
- **提案受諾/拒否ボタン** - 「このまま適用」「元に戻す」「別の案を提示」
- **コンテキスト保持** - 過去のやりとりを記憶して一貫性のある編集提案
- **部分選択編集** - HTML要素をクリック→該当箇所のみ編集可能
- **音声⇆チャット連携** - 音声で「ここを直して」→自動でチャット画面に反映

**UI要素：**
```
┌─ チャット履歴 ─────────────────┐
│ 👤 「見出しをもっと親しみやすく」    │
│ 🤖 「運動会について」              │
│    ↓「みんなで楽しむ運動会♪」      │
│    [✅適用] [❌拒否] [🔄別案]      │
│ 👤 「写真の配置を調整して」         │
│ 🤖 3つの配置案を提示中...          │
└─────────────────────────────┘
┌─ 新規入力 ─────────────────────┐
│ 💬 何か修正したいことはありますか？      │
│ [🎤音声] [📝テキスト]              │
└─────────────────────────────┘
```

**技術実装：**
- **WebSocket接続** でリアルタイムチャット
- **Diff アルゴリズム** で変更箇所可視化
- **Gemini 1.5 Pro** でコンテキスト理解
- **セッション管理** で編集履歴保持

*※ エディタ画面の3ペイン構成：左（音声入力）｜中央（WYSIWYG）｜右（AIチャット）*

---

## 6. データフロー

1. **録音 → STT**（PhraseHints=ユーザー辞書）
2. **Gemini**

   * 見出し生成 → レイアウト推薦 → リライト
3. **PDF/HTML 生成**（Functions）
4. **Drive 保存 & Classroom 投稿**
5. **Cloud Storage** に `YYYY/MM/通信タイトル.pdf` で保管

---

## 7. AI エージェント設計

| モジュール             | 役割               | API                  |
| ----------------- | ---------------- | -------------------- |
| STT Agent         | 音声→テキスト          | Cloud Speech-to-Text |
| Rewrite Agent     | 整形 & カスタム指示反映    | Gemini 1.5 Pro       |
| Outline Agent     | 話題分類＋見出し生成       | Gemini 1.5 Pro       |
| Layout Agent      | グラレコ風配置 & カラー季節化 | Gemini 1.5 Pro       |
| Narration Agent\* | TTS スライド朗読       | Cloud TTS            |

---

## 8. 開発スケジュール（6 週タイト版）

| 週 | 主要タスク                       |
| - | --------------------------- |
| 1 | 画面モック・辞書 CSV UI             |
| 2 | STT/録音 & ダッシュボード            |
| 3 | Gemini 見出し＋リライト             |
| 4 | レイアウト全まかせ & カラーパレット         |
| 5 | PDF/Drive/Classroom/LINE 配信 |
| 6 | QA・デモ動画撮影・提出                |

---

## 9. 成功指標 (KPI)

| 指標          | 目標         |
| ----------- | ---------- |
| 通信作成平均時間    | **≤20 分**  |
| 先生満足度 (NPS) | ＋25 pt     |
| 保護者閲覧率      | ＋30 %      |
| エラー率        | < 1 % 配信失敗 |

---

## 10. リスク & 対策

| リスク      | 対策                              |
| -------- | ------------------------------- |
| 音声誤変換    | 辞書拡充・手動修正欄                      |
| LINE 制限校 | Classroom URL を既定・LINE optional |
| 画像容量高    | 自動リサイズ (1280px)                 |

---

## 11. 今後の展開

* **多言語対応・通信簿自動化・閲覧分析**
* **自治体単位ライセンス** → 教育委員会 SaaS

---

## 12. 用語集（抜粋）

| 用語          | やさしい説明                                   |
| ----------- | ---------------------------------------- |
| **グラレコ風**   | 会議の内容をイラスト付きで板書する"グラフィックレコーディング"のようなデザイン |
| **全まかせボタン** | AI がレイアウトと色を一発で整える魔法のボタン                 |

---

### ☑︎ これで「ハッカソン必須技術」＋「追加要望」まで盛り込み、画面3枚で迷わないシンプル設計になりました。ご確認ください！
