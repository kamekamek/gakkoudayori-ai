# 🔄 学級通信AI リビルド管理システム

**作成日**: 2025-01-17  
**目的**: 複雑化したコードベースをリセットし、確実に動作する最小機能から段階的に構築

---

## 🎯 **リビルド方針**

### **Phase R (Reset): 最小機能実装**
- 音声入力 → テキスト変換 → HTML生成 の3ステップのみ
- 複雑なUI/UXは後回し
- 確実に動作することを最優先

### **コアフロー**
```
1. 🎤 音声録音 (Web Audio API)
   ↓
2. 📝 音声→テキスト (Google Speech-to-Text) 
   ↓
3. 🤖 テキスト→HTML (Gemini Pro)
   ↓
4. 📄 HTML表示・ダウンロード
```

---

## 📊 **現状把握システム**

### **仕様管理ファイル**: `docs/CURRENT_SPEC.md`
- 現在実装されている機能一覧
- 動作確認済み機能
- 既知の問題・バグ
- 次に実装予定の機能

### **進捗管理ファイル**: `docs/PROGRESS.md`  
- 日次進捗記録
- 作業ログ
- 問題解決履歴
- 意思決定記録

### **依存関係ファイル**: `docs/DEPENDENCIES.md`
- 必要最小限のパッケージリスト
- 各パッケージの使用目的
- バージョン管理

---

## 🗂️ **新しいファイル構成**

### **簡素化されたディレクトリ構造**
```
frontend/
├── lib/
│   ├── main.dart                 # エントリーポイント
│   ├── app.dart                  # アプリ設定
│   ├── core/
│   │   ├── services/
│   │   │   ├── audio_service.dart      # 音声録音
│   │   │   ├── speech_service.dart     # STT
│   │   │   └── ai_service.dart         # Gemini
│   │   └── models/
│   │       └── newsletter_data.dart    # データモデル
│   └── pages/
│       ├── home_page.dart              # メイン画面
│       └── result_page.dart            # 結果表示
├── web/
│   ├── index.html               # 基本HTML
│   └── audio.js                 # 音声録音JS
└── docs/
    ├── CURRENT_SPEC.md          # 現在仕様
    ├── PROGRESS.md              # 進捗記録
    └── DEPENDENCIES.md          # 依存関係
```

---

## 🎯 **リビルドタスク（Phase R）**

### **R1: プロジェクト初期化** (30分)
- [ ] 不要ファイル削除・整理
- [ ] 最小限pubspec.yaml作成
- [ ] 基本ディレクトリ構造作成

### **R2: 音声録音機能** (45分)
- [ ] Web Audio API統合
- [ ] 録音開始/停止UI
- [ ] 音声ファイル生成確認

### **R3: 音声認識機能** (60分) 
- [ ] Google Speech-to-Text連携
- [ ] 音声→テキスト変換確認
- [ ] エラーハンドリング

### **R4: AI文章生成** (90分)
- [ ] Gemini Pro API連携
- [ ] テキスト→HTML変換
- [ ] 学級通信テンプレート適用

### **R5: 結果表示** (30分)
- [ ] HTML表示
- [ ] ダウンロード機能
- [ ] 基本スタイリング

---

## 📝 **成功基準**

### **Phase R完了条件**
1. ✅ 音声録音→テキスト変換が動作
2. ✅ テキスト→HTML生成が動作  
3. ✅ 生成されたHTMLが表示される
4. ✅ HTMLファイルがダウンロードできる
5. ✅ エラーハンドリングが機能する

### **品質基準**
- 🚫 複雑なUI/UXは不要
- 🚫 レスポンシブデザインは不要
- 🚫 複数ページは不要
- ✅ シンプル・確実・動作する

---

## 📅 **スケジュール**

### **今日 (2025-01-17 23:30-)**
1. **23:30-24:00**: 現状整理・不要ファイル削除
2. **24:00-24:30**: 基本構造作成

### **明日 (2025-01-18)**  
1. **朝**: R2-R3 (音声機能)
2. **午後**: R4-R5 (AI機能・表示)
3. **夕方**: 統合テスト・動作確認

---

## 🔧 **開発ルール**

### **コーディング原則**
1. **シンプル第一**: 1ファイル200行以下
2. **依存最小**: 必要最小限のパッケージのみ
3. **テスト不要**: 動作確認は手動で十分
4. **美観不要**: 機能重視、見た目は後

### **コミットルール**
```
R1: 基本構造作成
R2: 音声録音実装
R3: 音声認識実装
R4: AI文章生成実装
R5: HTML表示実装
```

---

## 📞 **トラブルシューティング**

### **よくある問題**
1. **音声録音できない** → マイク許可確認
2. **Speech-to-Text失敗** → API キー確認  
3. **Gemini応答なし** → プロンプト簡素化
4. **HTML表示崩れ** → テンプレート見直し

### **デバッグ手順**
1. ブラウザDevTools確認
2. Flutter logs確認
3. API レスポンス確認
4. 段階的に機能分離テスト

---

**🎯 目標**: 明日夜までに「音声→HTML学級通信」の完全動作を実現！ 