# 📊 学級通信エディタ - ユーザーフロー設計ドキュメント v2.0

**作成日**: 2025-06-13  
**更新日**: 2025-06-13 (現在のMVP実装状況反映)
**対象**: 学校の先生（デジタル疎いユーザー）  
**実装状況**: MVP Phase 1 完了

---

## 🎯 **現在のMVP実装状況**

### **✅ 実装済みフロー（Phase 1 MVP）**
```
1. 🎤 音声録音ボタン押下
   ↓
2. 📝 文字起こし結果表示（Speech-to-Text）
   ↓
3. 🔧 ユーザー辞書で誤変換修正
   ↓
4. 🎨 スタイル選択（2つのボタン）
   ├─ 📜 クラシックボタン → CLASIC_TENSAKU.mdプロンプト使用
   └─ 🌟 モダンボタン → （未実装：今後モダン版プロンプト追加予定）
   ↓
5. 🤖 添削AI（第1エージェント）
   ├─ 入力：修正済み文字起こしテキスト
   ├─ プロンプト：CLASIC_TENSAKU.md（v2.2）
   └─ 出力：構造化JSON（学級通信用）
   ↓
6. 🎨 レイアウトAI（第2エージェント）
   ├─ 入力：構造化JSON
   ├─ プロンプト：CLASIC_LAYOUT.md（v2.2）
   └─ 出力：印刷対応HTML（シングルカラム・堅牢設計）
   ↓
7. 👁️ 下部にHTMLプレビュー表示
   ↓
8. 📄 PDF出力のみ（編集不可）
```

### **🔒 現在のMVP制約**
- ❌ **テキスト編集機能なし** - プレビュー後の編集不可
- ❌ **PDF出力のみ** - HTML保存やその他形式不可
- ❌ **2つのスタイルのみ** - クラシック/モダンの選択肢のみ
- ❌ **プレビュー固定** - レイアウト変更不可
- ✅ **シンプルUI** - 先生にとって分かりやすい

### **🎯 重要な品質要件（印刷時崩れ防止）**
- ✅ **印刷時レイアウト堅牢性** - いかなる内容量でも崩れない設計
- ✅ **プレビュー = 印刷状態** - 表示内容と印刷結果の完全一致
- ✅ **スマホでの印刷プレビュー** - 小画面でもA4印刷状態を正確表示
- ✅ **シングルカラム強制** - 多段組などの不安定技術を排除
- ✅ **A4固定レイアウト** - 210mm × 297mmの固定サイズ設計

---

## 👥 **ターゲットユーザー分析**

### **学校の先生の特徴**
- ✅ **デジタル疎い** - 複雑なUIは避ける
- ✅ **確認重視** - 生成結果を確認してから出力したい
- ✅ **シンプル志向** - 余計なボタン・機能は不要
- ✅ **柔軟性欲しい** - 音声だけでなく文字入力も
- ✅ **編集機能欲しい** - 生成後の微調整が必要

### **現在のMVPでの使用感**
- ✅ **音声入力は簡単** - 大きなボタンで分かりやすい
- ✅ **スタイル選択は直感的** - 2つのボタンで迷わない
- ❌ **編集できないのが不便** - 生成後の修正ができない
- ❌ **PDF以外の形式が欲しい** - HTML保存やコピー機能
- ⚠️ **プレビューが小さい** - 内容確認が困難

---

## 🚀 **段階的改善ロードマップ**

### **Phase 1: MVP（✅ 完了）**
- [x] 音声録音機能
- [x] 文字起こし機能
- [x] ユーザー辞書による誤変換修正
- [x] クラシック/モダンスタイル選択
- [x] JSON生成とレイアウトAI処理
- [x] HTMLプレビュー表示
- [x] PDF出力機能

### **Phase 2: 編集機能復活（🎯 次の優先事項）**
- [ ] **プレビュー後の編集機能**
  - [ ] インライン編集機能
  - [ ] テキスト修正機能
  - [ ] レイアウト微調整
- [ ] **出力形式拡張**
  - [ ] HTML保存機能
  - [ ] テキストコピー機能
  - [ ] 印刷プレビュー
- [ ] **印刷プレビュー改善**
  - [ ] 印刷状態での正確なプレビュー表示
  - [ ] スマホでのA4プレビュー最適化
  - [ ] 拡大・縮小表示機能
  - [ ] フルスクリーンプレビュー

### **Phase 3: 使いやすさ向上（2週間後）**
- [ ] **テキスト入力機能追加**
  - [ ] 音声が苦手な先生向け
  - [ ] 直接文字入力フィールド
- [ ] **スタイル選択拡張**
  - [ ] 季節テーマ追加
  - [ ] カラーバリエーション
- [ ] **プレビュー機能強化**
  - [ ] リアルタイムプレビュー
  - [ ] モバイル表示確認

### **Phase 4: 高度機能（1ヶ月後）**
- [ ] **テンプレート機能**
  - [ ] 保存済みテンプレート
  - [ ] カスタムスタイル
- [ ] **画像挿入機能**
  - [ ] 写真アップロード
  - [ ] AI画像生成統合
- [ ] **共有機能**
  - [ ] URL共有
  - [ ] メール送信

---

## 🔧 **技術仕様詳細**

### **クラシック/モダンボタンの動作（2エージェント・システムプロンプト連携）**

#### **🎯 実装済み：クラシックボタン**
```javascript
// クラシックボタン押下時の処理フロー
classicButton.onClick = async () => {
  // Step 1: 添削AI（第1エージェント）
  const jsonResult = await fetch('/api/v1/ai/speech-to-json', {
    method: 'POST',
    body: JSON.stringify({
      transcribed_text: userCorrectedText,
      style: 'classic'
    })
  });
  // → CLASIC_TENSAKU.md（v2.2）プロンプトでGemini呼び出し
  // → 構造化JSON出力
  
  // Step 2: レイアウトAI（第2エージェント）
  const htmlResult = await fetch('/api/v1/ai/json-to-graphical-record', {
    method: 'POST',
    body: JSON.stringify({
      json_data: jsonResult.data,
      template: 'classic'
    })
  });
  // → CLASIC_LAYOUT.md（v2.2）プロンプトでGemini呼び出し
  // → 印刷対応HTML出力（シングルカラム・堅牢設計）
  
  // Step 3: 印刷状態プレビュー表示
  displayPrintPreview(htmlResult.html_content);
}
```

#### **🚧 未実装：モダンボタン**
```javascript
// モダンボタン押下時（今後実装予定）
modernButton.onClick = async () => {
  // Step 1: 添削AI（第1エージェント）
  // → MODERN_TENSAKU.md プロンプト（作成予定）
  
  // Step 2: レイアウトAI（第2エージェント）  
  // → MODERN_LAYOUT.md プロンプト（作成予定）
  
  // Step 3: 印刷状態プレビュー表示
}
```

### **JSON構造例**
```json
{
  "style": "classic" | "modern",
  "content": {
    "title": "学級通信タイトル",
    "date": "2025-06-13",
    "body": "本文内容...",
    "sections": [
      {
        "type": "greeting",
        "content": "季節の挨拶..."
      },
      {
        "type": "main",
        "content": "メイン内容..."
      },
      {
        "type": "closing",
        "content": "締めの言葉..."
      }
    ]
  },
  "layout": {
    "template": "classic_layout_1",
    "colors": ["#2c3e50", "#3498db"],
    "fonts": ["Noto Sans JP"]
  }
}
```

### **2エージェント連携処理フロー**
```
📝 ユーザー音声入力（文字起こし + 辞書修正）
    ↓
🎨 スタイル選択（クラシック/モダン）
    ↓
🤖 【第1エージェント：添削AI】
    ├─ 入力：修正済みテキスト
    ├─ プロンプト：CLASIC_TENSAKU.md（v2.2）
    ├─ AI：Gemini 1.5 Pro
    └─ 出力：構造化JSON（教師らしい語り口調・学級通信構造）
    ↓
🎨 【第2エージェント：レイアウトAI】
    ├─ 入力：構造化JSON
    ├─ プロンプト：CLASIC_LAYOUT.md（v2.2）
    ├─ AI：Gemini 1.5 Pro
    └─ 出力：堅牢HTML（シングルカラム・印刷最適化・アクセシブル）
    ↓
👁️ 印刷状態プレビュー表示（A4固定・スマホ対応） → 📄 PDF出力
```

---

## 📊 **現在のMVPの評価**

### **✅ 成功している点**
- **シンプルなUI** - 先生が迷わない
- **音声入力の精度** - 文字起こしが正確
- **スタイル選択の直感性** - 2つのボタンで分かりやすい
- **PDF出力の品質** - 印刷に適した形式
- **処理速度** - 待ち時間が短い

### **❌ 改善が必要な点**
- **編集機能の欠如** - 生成後の修正ができない
- **出力形式の制限** - PDF以外の選択肢がない
- **プレビューの制約** - 内容確認が困難
- **柔軟性の不足** - カスタマイズができない

---

## 🎯 **Phase 2 実装計画（編集機能復活）**

### **優先度1: 編集機能復活（1週間）**
```
現在: プレビュー表示のみ（編集不可）
    ↓
改善: プレビュー + 編集モード切り替え
    ↓
実装: インライン編集機能
```

### **優先度2: 出力形式拡張（3日）**
```
現在: PDF出力のみ
    ↓
追加: HTML保存、テキストコピー
    ↓
実装: 複数出力形式対応
```

### **優先度3: 印刷プレビュー改善（2日）**
```
現在: 小さなプレビュー表示（印刷状態と異なる可能性）
    ↓
改善: 印刷状態完全再現プレビュー + スマホ対応
    ↓
実装: 
- A4固定サイズでの正確プレビュー
- スマホでの横スクロール/ズーム対応
- レスポンシブではなく印刷状態固定表示
```

---

## 📈 **成功指標**

### **Phase 1 MVP（達成済み）**
- ✅ 音声入力成功率 > 95%
- ✅ スタイル選択の直感性 > 90%
- ✅ PDF生成成功率 > 98%
- ✅ 処理時間 < 10秒

### **Phase 2 目標**
- 🎯 編集機能利用率 > 70%
- 🎯 出力形式多様化利用率 > 50%
- 🎯 **印刷プレビュー精度 > 99%** - プレビューと印刷結果の一致率
- 🎯 **スマホ印刷プレビュー満足度 > 85%** - 小画面での確認しやすさ
- 🎯 **印刷時レイアウト崩れ率 < 1%** - いかなる内容でも崩れない
- 🎯 全体的な使いやすさ > 90%

---

## 🔄 **更新履歴**

- **2025-06-13**: v2.0作成 - 現在のMVP実装状況を反映
- **重点**: 編集機能復活とユーザビリティ向上
- **方針**: 現在のシンプルなUIを維持しながら機能拡張 