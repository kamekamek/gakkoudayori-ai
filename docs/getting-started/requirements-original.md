## 1. プロジェクト概要

* **目的**：教員が週次で作成する「学級通信／学年通信／学校通信」を、**Google ADKによるマルチエージェントシステム**と自然な対話インターフェースで瞬時に作成し、美しいHTML出力・PDF変換まで一気通貫で行えるようにする。
* **ゴール**：作成時間を現状の2–3時間から **20分以内** に短縮し、教員の残業削減と保護者とのコミュニケーション活性化を実現。
* **技術革新**：Google ADKを活用した**2段階ワークフロー**（対話→レイアウト）で、シンプルかつ強力な学級通信生成システムを実現。

## 2. 対象ユーザー

* 小～中学校の担任・学年主任・教務主任
* 教育現場で日々忙殺されている教員

## 3. コア機能要件（ADK統合版）

### 🤖 ADK マルチエージェントアーキテクチャ

本プロジェクトは **Google ADK (Agent Development Kit)** を活用したマルチエージェントシステムとして実装されています：

| エージェント | 役割 | 技術詳細 |
|------------|------|----------|
| **対話エージェント** | ユーザーとの自然な対話<br>構造化データ（JSON）生成 | • `docs/bot_prompt.md` ベース<br>• Gemini 1.5 Pro<br>• 完全リード型対話設計 |
| **レイアウトエージェント** | JSONからHTML生成<br>美しいレイアウト設計 | • `docs/layout.md` ベース<br>• A4比率・2段組・印刷最適化<br>• レスポンシブデザイン |
| **オーケストレーター** | ワークフロー管理<br>エージェント間連携 | • シンプル2段階フロー<br>• エラーハンドリング<br>• 進捗管理 |

### 💬 ユーザー体験フロー
1. **「こんにちは」** → 対話エージェントが自然な対話を開始
2. **ヒアリング** → 学校名、クラス、内容等を対話形式で収集
3. **JSON生成** → 構造化されたデータとして保存
4. **HTML生成** → 美しいレイアウトで学級通信を自動作成
5. **編集・完成** → Quill.jsエディタで最終調整

---

## 3.1. 従来機能要件（参考）

| No. | 機能           | 詳細                                                                                    |
| --- | ------------ | ------------------------------------------------------------------------------------- |
| 1   | チャット型音声入力    | • チャットバブル形式でマイクアイコンをタップ→即録音・文字起こし<br>• リアルタイム文字起こしプレビュー & 誤変換タップ編集                    |
| 2   | AI文章整形（リライト） | • ユーザー辞書を組み込んだカスタムプロンプトで敬語調整／句読点<br>• 見出し自動生成ボタン                                      |
| 3   | レイアウト選択      | • テーマカラー（7色程度）・フォーマット4種（標準／画像多め／画像少なめ／画像なし）<br>• “おまかせ”自動レイアウト                        |
| 4   | WYSIWYGエディタ  | • 生成済みHTMLのインライン編集<br>• テキスト装飾（太字・見出し・箇条書き）<br>• 画像挿入（カメラ・ギャラリー選択→Storageアップロード→埋め込み） |
| 5   | PDF出力        | • A4固定フォーマットでのPDF生成<br>• レスポンシブ／将来対応はオプション                                            |
| 6   | 配信機能         | • Google Classroom 連携（クラス選択→一括配信）<br>• LINE 通知（トークン管理→メッセージ送信）                        |

## 4. ユーザー体験（UX）要件

* **シームレスなチャット操作**：録音→整形→レイアウト→編集→出力まで、全工程を「会話する」感覚で完結
* **進捗可視化**：画面上にプログレスバー＋ステップサマリーを表示
* **オフライン下書きモード**：通信が不安定な環境でもローカル編集が可能
* **マルチデバイス同期**：スマホ・PC・タブレット間で状態同期
* **アクセシビリティ**：キーボードショートカット（PC）、画面読み上げ対応

## 5. 非機能要件

* **セキュリティ**：OAuth2＋Firebase Authentication で認証・API呼び出しを保護
* **パフォーマンス**：応答遅延は各ステップ 3 秒以下、PDF出力は 5 秒以下
* **可用性**：99.9% 稼働（GCP 各種マネージドサービス採用）
* **拡張性**：エージェント／ツール設計により、将来的に「心のケアチャット」など新機能を追加しやすい構造

## 6. 技術要件

* **フロントエンド**：Flutter（Android／iOS／Web 対応）

  * リッチテキスト／HTML編集：`flutter_quill`＋`flutter_quill_extensions`（画像埋め込み対応）
  * 音声入力：ネイティブマイクAPI＋リアルタイムSTTプレビュー
* **バックエンド**：Google Cloud 上に以下を構築

  * Vertex AI & Gemini モデル（AI整形・見出し生成）
  * Cloud Functions or Cloud Run（エンドポイント実装）
  * Firestore／Firebase Storage（ユーザー辞書・履歴・画像管理）
  * Cloud Scheduler + Pub/Sub（定期タスク・ログ集約）
* **CI/CD**：Cloud Build + GitHub Actions でビルド・デプロイ自動化

## 7. 開発フロー（PoC→MVP→本番）

1. **PoC**

   * チャットUI＋音声入力 → Gemini呼び出し → HTML生成 → PDF出力
   * Flutter Quillで簡易編集＋画像挿入検証
2. **MVP**

   * 全機能フロー統合・安定化
   * 6名程度のテスターによるユーザーテスト
3. **本番**

   * UI/UX 改善・パフォーマンスチューニング
   * 教職員ネットワークを活用したβ版リリース

