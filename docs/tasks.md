# ゆとり職員室 実装タスクリスト

**HTMLベースグラレコ風学級通信作成システム - 実装管理**

---

**📚 ドキュメントナビ**: [📋 Index](index.md) | [📖 Overview](README.md) | [📝 要件定義](REQUIREMENT.md) | [🏗️ システム設計](system_design.md) | **📋 タスク** | [🧪 TDD](tdd_guide.md)

---

## 📋 タスク管理ルール

### ✅ 完了条件
各タスクは以下の条件をすべて満たした場合のみチェック可能：
1. **機能実装**: コードが動作し、期待される機能を提供
2. **テスト通過**: 単体テスト・統合テストが成功（TDD必須）
3. **品質確認**: コードレビュー完了・ドキュメント更新
4. **動作検証**: 実際の使用シナリオで問題なく動作

**🧪 TDD必須タスク**（🔴 Red → 🟢 Green → 🔵 Refactor で実装）:
- 音声認識・Geminiリライト・PDF生成のコアロジック
- API エンドポイント・データベース操作
- 重要な UI コンポーネント

詳細は [tdd_guide.md](tdd_guide.md) を参照

### 🎯 優先度
- **🔴 HIGH**: システムの基幹機能、他タスクのブロッカー、ハッカソンMVP必須
- **🟡 MEDIUM**: 重要だが緊急性は中程度、UX向上・品質確保
- **🟢 LOW**: 改善・最適化系のタスク、拡張機能（Optional）

---

## Phase 1: 基盤構築 (Week 1-2)

### 🏗️ 環境構築・プロジェクト初期化

#### Google Cloud セットアップ
- [x] **🔴** Google Cloud プロジェクト作成
  - **完了条件**: プロジェクトID確定、課金設定完了、基本サービス有効化 ✅ *2024-12-25*
- [x] **🔴** Vertex AI API有効化・認証設定
  - **完了条件**: Gemini 1.5 Pro APIコール成功、Speech-to-Text動作確認 ✅ *2024-12-25*
- [x] **🔴** Cloud Run・Cloud Storage・Firestore有効化
  - **完了条件**: 各サービスのHello Worldデプロイ成功 ✅ *2024-12-25*

#### プロジェクト構造構築
- [x] **🔴** Flutter Web プロジェクト初期化
  - **完了条件**: `flutter run -d chrome`で起動、Firebase接続確認 ✅ *2024-12-25*
- [x] **🔴** FastAPI バックエンドプロジェクト作成
  - **完了条件**: `/health`エンドポイント応答、ローカル起動確認 ✅ *2024-12-25*
- [ ] **🟡** CI/CD パイプライン構築
  - **完了条件**: GitHub Actions自動デプロイ、Cloud Build設定完了

### 🔧 基本API実装

#### 認証・セキュリティ
- [ ] **🔴** Firebase Authentication統合
  - **完了条件**: Google ログイン動作、JWT トークン検証成功
- [ ] **🟡** CORS設定・セキュリティヘッダー実装
  - **完了条件**: ブラウザからの適切なAPI アクセス確認

#### AI機能基盤
- [ ] **🔴** Vertex AI Gemini 統合
  - **完了条件**: テキストリライト機能動作、応答時間<500ms確認
- [ ] **🔴** Speech-to-Text API統合（ノイズ抑制機能込み）
  - **完了条件**: 音声ファイルアップロード→テキスト変換成功、ノイズ環境での認識精度
- [ ] **🔴** ユーザー辞書機能（基本版）
  - **完了条件**: カスタムキーワードでSTT精度向上確認、CSV一括登録機能
- [ ] **🔴** AI見出し生成機能
  - **完了条件**: 入力文をトピック分割、適切な見出し候補提示
- [ ] **🔴** カスタム指示機能
  - **完了条件**: 「やさしい語り口」「学年主任らしい口調」等のワンフレーズ反映
- [ ] **🟡** Text-to-Speech API統合（将来のスライドショー機能用）
  - **完了条件**: 音声合成動作確認、自然な読み上げ品質

### 📱 基本UI構築

#### Flutter Web UI
- [x] **🔴** ダッシュボード画面実装
  - **完了条件**: 過去通信一覧表示、新規作成ボタン動作 ✅ *2025-06-06*
- [x] **🔴** 基本エディタ画面レイアウト
  - **完了条件**: 3ペイン構成（音声入力｜エディタ｜プレビュー）表示 ✅ *2025-06-06*
- [x] **🔴** 設定画面実装
  - **完了条件**: ユーザー辞書登録・Google Drive連携設定・LINE通知ON/OFF設定 ✅ *2025-06-06*
- [x] **🔴** 音声入力UI（ワンタップ録音・リアルタイム字幕）
  - **完了条件**: ワンタップ録音開始・停止、リアルタイム音声認識結果表示 ✅ *2025-06-06*
- [x] **🟡** レスポンシブ対応
  - **完了条件**: スマートフォン・タブレットで適切表示 ✅ *2025-06-06*

#### データ永続化
- [ ] **🔴** Firestore スキーマ実装
  - **完了条件**: Users/Documents/Templates コレクション CRUD動作
- [ ] **🔴** Cloud Storage 統合
  - **完了条件**: ファイルアップロード・ダウンロード・月別フォルダ作成
- [ ] **🔴** 履歴管理機能
  - **完了条件**: 通信の下書き保存・復元・削除・「完了(Done)」ボタン機能

---

## Phase 2: HTMLエディタ実装 (Week 3-4)

### ✏️ WYSIWYGエディタ統合

#### HTMLエディタ基盤
- [ ] **🔴** `html_editor_enhanced` 統合
  - **完了条件**: エディタ表示、基本テキスト入力・書式設定動作
- [ ] **🔴** カスタムツールバー実装
  - **完了条件**: 学級通信特化ボタン（見出し・吹き出し・アイコン）
- [ ] **🔴** リアルタイムプレビュー機能
  - **完了条件**: エディタ編集→即座にプレビュー反映（遅延<100ms）
- [ ] **🟡** HTML↔Flutter間データ同期
  - **完了条件**: エディタ内容の保存・読み込み・状態管理

#### チャットベース編集システム
- [ ] **🔴** WebSocketチャット基盤実装
  - **完了条件**: リアルタイム双方向通信、セッション管理
- [ ] **🔴** 差分表示機能（diff_match_patch）
  - **完了条件**: 編集前後の色分けハイライト表示
- [ ] **🔴** リアルタイム編集提案UI
  - **完了条件**: チャット入力→AI提案→受諾/拒否ボタン動作
- [ ] **🟡** 音声⇆チャット連携
  - **完了条件**: 音声で「ここを直して」→チャット画面に自動反映

### 🎨 テンプレート・グラフィック要素

#### HTMLテンプレートシステム
- [ ] **🔴** HTMLテンプレート管理API
  - **完了条件**: テンプレート CRUD、動的適用機能
- [ ] **🔴** 基本的なグラレコテンプレート作成
  - **完了条件**: 吹き出し・アイコン配置・手描き風スタイル 5パターン
- [ ] **🟡** テンプレート選択UI
  - **完了条件**: プレビュー付きテンプレート選択、ワンクリック適用

#### アイコン・素材システム
- [ ] **🔴** SVGアイコンライブラリ構築
  - **完了条件**: 学校・季節・活動・感情カテゴリ 各10個以上
- [ ] **🔴** 素材管理API実装
  - **完了条件**: アイコン検索・取得・カテゴリ分類機能
- [ ] **🔴** ドラッグ&ドロップ素材挿入
  - **完了条件**: パレットからエディタへのD&D操作、位置調整
- [ ] **🟡** 季節別素材セット作成
  - **完了条件**: 春夏秋冬の色・アイコン・背景セット

#### スタイリングシステム
- [ ] **🔴** 季節カラーパレット実装
  - **完了条件**: 4季節の色彩テーマ、ワンクリック適用
- [ ] **🔴** CSS動的生成機能
  - **完了条件**: テンプレート＋カラー→CSS自動生成・適用
- [ ] **🟡** 手描き風フォント統合
  - **完了条件**: 日本語手書き風フォント、エディタでの表示確認
- [ ] **🟡** アニメーション要素（Lottie）
  - **完了条件**: 軽量アニメーション素材、HTML埋め込み

---

## Phase 3: グラレコ要素強化 (Week 5)

### 🤖 高度なレイアウト機能

#### 自動レイアウト生成
- [ ] **🔴** Gemini によるレイアウト最適化
  - **完了条件**: コンテンツ解析→最適テンプレート選択・提案
- [ ] **🔴** "全まかせボタン"実装
  - **完了条件**: ワンクリックで最適レイアウト・色・アイコン適用
- [ ] **🟡** コンテンツ解析→最適テンプレート選択
  - **完了条件**: 運動会・学習・行事等のトピック自動判定

#### 吹き出し・装飾機能
- [ ] **🔴** 音声入力内容を自動で吹き出し化
  - **完了条件**: 発話者・内容に応じた吹き出しスタイル自動選択
- [ ] **🟡** 手描き風境界線・装飾
  - **完了条件**: CSS/SVGによる手描き風ボーダー・フレーム
- [ ] **🟡** 重要度に応じた強調表示
  - **完了条件**: キーワード検出→自動強調・アイコン追加

### 🔄 インタラクティブ要素

#### HTML↔PDF切り替え
- [ ] **🔴** WeasyPrint によるHTML→PDF変換
  - **完了条件**: レイアウト保持、日本語フォント対応、変換時間<3秒
- [ ] **🔴** 印刷レイアウト最適化
  - **完了条件**: A4サイズ最適化、印刷時の色・画像品質確認
- [ ] **🟡** インタラクティブ要素の処理
  - **完了条件**: HTML版でのホバー・アニメーション、PDF版での静的表示

#### アニメーション要素
- [ ] **🟡** Lottie アニメーション統合
  - **完了条件**: 軽量アニメーション（<100KB）の埋め込み・再生
- [ ] **🟢** ホバー効果・クリック反応
  - **完了条件**: CSS アニメーション、ユーザビリティ向上確認
- [ ] **🟡** スマートフォン用の最適化
  - **完了条件**: タッチ操作対応、レスポンシブアニメーション

---

## Phase 4: 統合・最適化 (Week 6)

### 🎬 拡張機能（Optional）

#### スライドショー・音声ナレーション機能
- [ ] **🟢** スライドショー自動生成
  - **完了条件**: 画像⇆音声で自動スライド作成、コンテンツの流れ最適化
- [ ] **🟢** AI ナレーション機能（TTS朗読）
  - **完了条件**: Text-to-Speech で通信内容の自然な朗読、音声ファイル生成

### 📤 配信システム統合

#### 複数フォーマット対応
- [ ] **🔴** PDF・HTML両方の配信
  - **完了条件**: 同一コンテンツの2フォーマット同時生成・配信
- [ ] **🔴** Google Classroom API統合
  - **完了条件**: 投稿作成・ファイル添付・生徒への通知
- [ ] **🔴** Google Drive保存（月別フォルダ自動振り分け）
  - **完了条件**: YYYY/MM/通信タイトル.pdf形式で月別フォルダ自動作成・権限設定・共有リンク生成
- [ ] **🟡** LINE通知システム
  - **完了条件**: 通信配信完了の保護者への自動通知（オプション）
- [ ] **🔴** Cloud Functions PDF生成・Drive同期
  - **完了条件**: HTML→PDF変換、Drive自動アップロード、処理完了通知

#### 品質保証
- [ ] **🔴** HTML構文チェック
  - **完了条件**: HTML5 Validator通過、アクセシビリティ基準準拠
- [ ] **🟡** アクセシビリティ検証
  - **完了条件**: WCAG 2.1 AA準拠、スクリーンリーダー対応
- [ ] **🟡** 各ブラウザでの表示確認
  - **完了条件**: Chrome/Safari/Edge での一貫表示

### ⚡ パフォーマンス最適化

#### 速度改善
- [ ] **🔴** 画像最適化・圧縮
  - **完了条件**: 自動リサイズ（1280px以下）・WebP変換・読み込み時間短縮
- [ ] **🟡** CSS/JS minification
  - **完了条件**: ビルド時の最小化・gzip圧縮・CDN配信
- [ ] **🟢** CDN配信設定
  - **完了条件**: 静的アセットのCDN配信・キャッシュ戦略
- [ ] **🟡** キャッシュ戦略実装
  - **完了条件**: API レスポンス・画像のローカルキャッシュ

#### ユーザビリティテスト
- [ ] **🔴** 実際の教師によるテスト
  - **完了条件**: 5名以上の教師が20分以内で通信作成完了
- [ ] **🔴** UI/UX改善
  - **完了条件**: ユーザビリティテスト結果基準のUI調整
- [ ] **🔴** エラーハンドリング強化
  - **完了条件**: 全APIエンドポイントの適切なエラーレスポンス
- [ ] **🟡** ヘルプ・チュートリアル作成
  - **完了条件**: 初回利用時のガイダンス・ヘルプドキュメント

---

## 🎯 最終目標検証

### システム性能指標
- [ ] **🔴** 音声入力→HTMLグラレコ風編集→PDF/配信まで20分以内
  - **完了条件**: 5回連続テストで20分以内完了率100%
- [ ] **🔴** HTMLエディタ応答時間 < 100ms
  - **完了条件**: 文字入力・書式変更の応答時間測定
- [ ] **🔴** PDF生成時間 < 3秒
  - **完了条件**: 標準的な通信（2ページ、画像5枚）の変換時間
- [ ] **🔴** 音声認識精度 > 95%
  - **完了条件**: 教育現場の音声サンプルでの認識精度測定

### ユーザー体験指標
- [ ] **🔴** ユーザビリティスコア > 4.0/5.0
  - **完了条件**: 教師5名によるSUS（System Usability Scale）スコア
- [ ] **🔴** エラー発生率 < 1%
  - **完了条件**: 100回の操作で1回未満のエラー発生
- [ ] **🔴** 通信作成時間 < 20分
  - **完了条件**: 従来手法（平均2-3時間）から90%以上の時間短縮

---

## 📊 進捗管理

### 完了率
- **Phase 1**: 10/24 タスク (41.7%)
- **Phase 2**: 0/19 タスク (0%)
- **Phase 3**: 0/11 タスク (0%)
- **Phase 4**: 0/18 タスク (0%)
- **最終検証**: 0/7 タスク (0%)

**全体進捗**: 10/79 タスク (12.7%)

### 今週のフォーカス
現在実装すべき最優先タスク：
1. ~~**🔴** Google Cloud プロジェクト作成~~ ✅
2. ~~**🔴** Vertex AI API有効化・認証設定~~ ✅
3. ~~**🔴** Flutter Web プロジェクト初期化~~ ✅
4. ~~**🔴** FastAPI バックエンドプロジェクト作成~~ ✅
5. ~~**🔴** Cloud Run・Cloud Storage・Firestore有効化~~ ✅
6. **🔴** Firebase Authentication統合 *← 次のタスク*

**主要機能要件カバレッジ確認**:
✅ 全14項目の機能要件が実装タスクに含まれていることを確認
✅ ハッカソン必須要件（Google Cloud + AI技術）完全対応
✅ 非機能要件（UX・速度・セキュリティ・アクセシビリティ）対応

---

*最終更新: 2025年6月* 