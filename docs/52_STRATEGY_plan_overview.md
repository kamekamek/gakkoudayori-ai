# 学校だよりAI プロジェクト実装計画

## 1. 概要

このドキュメントは「学校だよりAI」プロジェクトの全体的な実装計画をまとめたものです。要件定義に基づき、Quill.jsを使用したWYSIWYGエディタとGemini AIを統合した学級通信作成システムの実装方針を説明します。

## 2. フェーズ別実装計画

### フェーズ1: 初期化と基盤構築 (1-2日)

| # | タスク | 担当 | 詳細 |
|---|-------|------|------|
| 1.1 | プロジェクト構造整理 | - | 既存リポジトリをベースに構造整理 |
| 1.2 | 開発環境設定 | - | Flutter/Dart開発環境の確認と設定 |
| 1.3 | WebView基盤実装 | - | Flutter WebViewの基本実装 |
| 1.4 | バックエンドAPI設計 | - | Gemini APIラッパーの設計 |
| 1.5 | リポジトリ設定 | - | ブランチ戦略とCIの設定 |

### フェーズ2: Quill.js統合 (2-3日)

| # | タスク | 担当 | 詳細 |
|---|-------|------|------|
| 2.1 | Quill.js実装 | - | WebViewにQuill.jsを組み込み |
| 2.2 | JS-Dartブリッジ | - | 双方向通信実装 |
| 2.3 | Delta⇔HTML変換 | - | フォーマット変換関数実装 |
| 2.4 | 季節テーマ適用 | - | 季節カラーパレットの実装 |
| 2.5 | エディタ基本操作 | - | 基本編集機能の実装 |

### フェーズ3: AI補助UI (2-3日)

| # | タスク | 担当 | 詳細 |
|---|-------|------|------|
| 3.1 | 折りたたみUI実装 | - | 折りたたみパネル基本実装 |
| 3.2 | AI機能ボタン実装 | - | 定型AI機能のボタン実装 |
| 3.3 | Gemini API連携 | - | タグ制約プロンプト実装 |
| 3.4 | エディタ挿入機能 | - | 生成結果の挿入実装 |
| 3.5 | カスタム指示入力 | - | ユーザー指定プロンプト実装 |

### フェーズ4: ストレージ連携 (1-2日)

| # | タスク | 担当 | 詳細 |
|---|-------|------|------|
| 4.1 | Firestoreスキーマ | - | データモデル実装 |
| 4.2 | Storage保存 | - | HTML/Delta保存実装 |
| 4.3 | メタデータ管理 | - | タイトル・状態管理実装 |
| 4.4 | 一覧画面実装 | - | 保存済み文書一覧表示 |
| 4.5 | 読み込み機能 | - | 保存データの読み込み実装 |

### フェーズ5: 出力機能 (1-2日)

| # | タスク | 担当 | 詳細 |
|---|-------|------|------|
| 5.1 | PDF生成基盤 | - | HTML→PDF変換実装 |
| 5.2 | プリント用CSS | - | 印刷用スタイル実装 |
| 5.3 | Drive連携 | - | Google Drive保存実装 |
| 5.4 | 共有設定 | - | 保護者向け共有設定実装 |
| 5.5 | Classroom連携 | - | Google Classroom投稿実装 |

### フェーズ6: グラレコ要素 (2-3日)

| # | タスク | 担当 | 詳細 |
|---|-------|------|------|
| 6.1 | テンプレート作成 | - | グラレコ風テンプレート実装 |
| 6.2 | 装飾コンポーネント | - | 吹き出し・アイコン等実装 |
| 6.3 | ドラッグ&ドロップ | - | 要素配置機能実装 |
| 6.4 | レイアウト調整 | - | グリッド配置機能実装 |
| 6.5 | プレビュー機能 | - | リアルタイムプレビュー実装 |

### フェーズ7: テスト・最適化 (1-2日)

| # | タスク | 担当 | 詳細 |
|---|-------|------|------|
| 7.1 | 単体テスト | - | 各機能の動作テスト |
| 7.2 | E2Eテスト | - | 一連の操作テスト |
| 7.3 | パフォーマンス最適化 | - | 処理速度・メモリ最適化 |
| 7.4 | UI/UX改善 | - | フィードバックに基づく改善 |
| 7.5 | マニュアル作成 | - | 使用方法ドキュメント作成 |

## 3. 技術スタック詳細

### フロントエンド

- **Flutter**: バージョン 3.32.2
- **WebView**: webview_flutter 4.9.0
- **状態管理**: provider 6.1.5
- **ルーティング**: go_router 13.2.0
- **HTTP**: dio 5.4.0
- **Firebase**: firebase_core 3.13.0, firebase_auth 5.5.2

### バックエンド

- **FastAPI**: バージョン 0.104.1
- **Google Cloud**: google-cloud-aiplatform 1.71.0+
- **PDF生成**: weasyprint 60.2, reportlab 4.0.4
- **Firebase Admin**: firebase-admin 6.2.0

### Quill.js

- **バージョン**: 2.0.0
- **テーマ**: Snow
- **モジュール**: toolbar, history, clipboard

## 4. インフラストラクチャ

### 開発環境

- **ローカル開発**: Flutter + Chrome
- **API開発**: FastAPI + uvicorn

### 本番環境

- **フロントエンド**: Firebase Hosting
- **バックエンド**: Cloud Run
- **データベース**: Firestore
- **ストレージ**: Cloud Storage
- **AI**: Vertex AI (Gemini)

## 5. マイルストーン

| マイルストーン | 予定日 | 内容 |
|--------------|-------|------|
| **アルファ版** | 1週間後 | 基本エディタ機能 + AI補助基本機能 |
| **ベータ版** | 2週間後 | 保存/読込 + PDF出力 + グラレコ基本要素 |
| **リリース候補** | 3週間後 | 全機能実装 + バグ修正 |
| **正式リリース** | 4週間後 | 最終テスト完了 + マニュアル完備 |

## 6. リスクと対策

| リスク | 影響度 | 対策 |
|-------|-------|------|
| WebView連携の複雑さ | 高 | 早期からプロトタイプで検証、段階的実装 |
| Gemini APIの制限 | 中 | バックオフ戦略とキャッシュ機構の実装 |
| 複数デバイス対応 | 中 | レスポンシブデザインとブレークポイント設定 |
| パフォーマンス問題 | 中 | 早期からのプロファイリングと最適化 |

## 7. 開発プロセス

1. **タスク分解**: Issueとして登録
2. **ブランチ作成**: `feature/[issue-number]-[brief-description]`
3. **実装**: コーディング規約に従って実装
4. **テスト**: 単体テストとE2Eテスト
5. **レビュー**: Pull Requestでコードレビュー
6. **マージ**: 承認後にdevelopブランチへマージ
7. **デプロイ**: CIパイプラインでテスト環境へデプロイ

## 8. ドキュメント計画

| ドキュメント | 説明 | 優先度 |
|------------|------|-------|
| 技術仕様書 | 各コンポーネントの詳細仕様 | 高 |
| API仕様書 | バックエンドAPIの仕様 | 高 |
| デプロイガイド | 環境構築とデプロイ手順 | 中 |
| ユーザーマニュアル | エンドユーザー向け使用方法 | 高 |
| 開発者ガイド | 開発参加者向けガイド | 中 | 