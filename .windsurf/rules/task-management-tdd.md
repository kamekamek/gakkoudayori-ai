---
trigger: always_on
---

# タスク管理 & TDD実装統合ルール

## 🎯 基本方針

このプロジェクトでは @tasks.md のタスク管理とTDD実装フローを連携させ、効率的な開発を行います。

## 📋 タスク完了フロー

### 1. タスク開始時
タスクを開始する際は、必ず以下の手順を実行：

```markdown
#### T1-GCP-001-M: Google Cloudプロジェクト作成
- **作業者**: 🔧 MANUAL
- **所要時間**: 20分
- **依存**: なし
- **進行状況**: 🚀 進行中 (開始: 2025-06-09 23:30)
- **完了条件**: 
  - [ ] Google Cloudプロジェクト作成完了
  - [ ] プロジェクトID記録（環境変数用）
  - [ ] 課金アカウント有効化確認
```

### 2. タスク完了時
タスクが完了した際は、必ず以下の更新を実行：

```markdown
#### T1-GCP-001-M: Google Cloudプロジェクト作成 ✅
- **作業者**: 🔧 MANUAL
- **所要時間**: 20分 (実績: 18分)
- **依存**: なし
- **進行状況**: ✅ 完了 (2025-06-09 23:48)
- **完了条件**: 
  - [x] Google Cloudプロジェクト作成完了
  - [x] プロジェクトID記録（環境変数用）  
  - [x] 課金アカウント有効化確認
- **成果物**: プロジェクトID `yutori-kyoshitu-ai`
```

## 🔴🟢🔵 TDD統合フロー

### AI/HYBRIDタスクでのTDD実装

AI実装タスクでは、必ずTDDサイクルを実行：

#### Red Phase（テスト作成）
```markdown
#### T1-GCP-004-A: 認証テストコード実装
- **TDD Phase**: 🔴 RED - テスト作成中
- **進行状況**: 🚀 進行中
- **完了条件**:
  - [ ] Google Cloud認証テスト実装 🔴
  - [ ] 各API接続テスト作成 🔴
  - [ ] 認証エラーハンドリングテスト 🔴
  - [ ] 全テスト通過確認
```

#### Green Phase（最小実装）
```markdown
#### T1-GCP-004-A: 認証テストコード実装
- **TDD Phase**: 🟢 GREEN - 実装中
- **進行状況**: 🚀 進行中
- **完了条件**:
  - [x] Google Cloud認証テスト実装 🔴→🟢
  - [x] 各API接続テスト作成 🔴→🟢
  - [ ] 認証エラーハンドリングテスト 🟢
  - [ ] 全テスト通過確認
```

#### Blue Phase（リファクタリング）
```markdown
#### T1-GCP-004-A: 認証テストコード実装
- **TDD Phase**: 🔵 BLUE - リファクタリング中  
- **進行状況**: 🚀 進行中
- **完了条件**:
  - [x] Google Cloud認証テスト実装 🔴→🟢→🔵
  - [x] 各API接続テスト作成 🔴→🟢→🔵
  - [x] 認証エラーハンドリングテスト 🔴→🟢→🔵
  - [ ] 全テスト通過確認
```

#### 完了
```markdown
#### T1-GCP-004-A: 認証テストコード実装 ✅
- **TDD Phase**: ✅ 完了
- **進行状況**: ✅ 完了 (2025-06-09 24:15)
- **完了条件**:
  - [x] Google Cloud認証テスト実装 ✅
  - [x] 各API接続テスト作成 ✅  
  - [x] 認証エラーハンドリングテスト ✅
  - [x] 全テスト通過確認 ✅
- **成果物**: `test/services/gcp_auth_test.dart` (カバレッジ: 92%)
```

## 📊 進捗管理の自動更新

### タスク完了時の自動更新

AI/アシスタントがタスクを完了した際は、@tasks.md の以下のセクションも自動更新：

```markdown
### Phase 1 進捗 (18タスク)
- **Group A**: 4/4 完了 (GCP基盤) ✅
- **Group B**: 2/5 完了 (Firebase基盤) 🚀  
- **Group C**: 0/6 完了 (Flutter基盤)
- **環境設定**: 1/3 完了

**全体進捗**: 7/58 タスク完了 (12.1%) ⬆️
```

### 依存関係の自動チェック

タスク完了時は依存関係を確認し、次のタスクのブロック解除：

```markdown
#### T1-GCP-004-A: 認証テストコード実装 ✅
- **依存**: T1-GCP-003-M ✅ → ブロック解除

#### T1-FB-005-A: Firebase SDK統合コード 🚀 実行可能
- **依存**: T1-FB-002-M ✅, T1-FB-003-M ✅, T1-FB-004-M ✅
```

## 🎯 実装時の必須チェック

### Manual タスク完了確認
```bash
# 1. 設定確認
echo "✅ Manual設定完了"

# 2. tasks.md更新
# - [ ] → [x] 変更
# - 進行状況更新
# - 実績時間記録

# 3. 次タスクの依存確認
echo "🔍 依存関係チェック完了"
```

### AI タスク完了確認
```bash
# 1. テスト実行
flutter test  # または対応するテストコマンド

# 2. 品質確認  
flutter analyze
dart format .

# 3. tasks.md更新
# - TDD Phase表示
# - カバレッジ記録
# - 成果物リンク

# 4. コミット
git add .
git commit -m "✅ T1-XX-XXX: タスク名完了"
```

## 📝 進捗レポート生成

### 日次進捗サマリー
```markdown
## 📈 本日の進捗 (2025-06-09)

### 完了タスク
- ✅ T1-GCP-001-M: Google Cloudプロジェクト作成 (18分)
- ✅ T1-GCP-002-M: 必要API有効化 (25分)
- ✅ T1-GCP-003-M: サービスアカウント設定 (22分)

### 進行中タスク  
- 🚀 T1-FB-001-M: Firebase プロジェクト設定 (50%完了)

### 明日の予定
- T1-FB-002-M: Authentication設定
- T1-FL-001-M: Flutter Web環境構築
- T1-GCP-004-A: 認証テストコード実装

### 全体進捗
- **完了**: 3/58 タスク (5.2%)
- **予定**: Phase 1完了目標 6/10まで
```

## ⚡ 効率化コマンド

### タスク開始
```bash
# タスク開始マクロ
task_start() {
    echo "🚀 タスク $1 開始: $(date '+%Y-%m-%d %H:%M')"
    # tasks.md の該当行を自動更新
}
```

### タスク完了
```bash  
# タスク完了マクロ
task_complete() {
    echo "✅ タスク $1 完了: $(date '+%Y-%m-%d %H:%M')"
    # tasks.md の自動更新
    # 依存関係チェック
    # 次タスクのブロック解除
}
```

このルールにより、@tasks.md の進捗管理とTDD実装が自動的に連携し、効率的な開発が可能になります。
