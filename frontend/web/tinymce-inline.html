<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TinyMCE Editor</title>
    <script src="https://cdn.jsdelivr.net/npm/tinymce@6.8.3/tinymce.min.js"></script>
</head>
<body style="margin:0;padding:10px;font-family:Arial,sans-serif;">
    <div id="status" style="text-align:center;padding:20px;color:#666;">
        📝 エディタを読み込み中...
    </div>
    
    <textarea id="editor">
        <h1>🌸 学級通信 🌸</h1>
        <p>こんにちは、保護者の皆様。</p>
        <p>今日は素晴らしい一日でした。</p>
    </textarea>

    <script>
        console.log('🚀 TinyMCE inline 開始');
        
        if (typeof tinymce === 'undefined') {
            document.getElementById('status').innerHTML = '❌ TinyMCE読み込み失敗';
            console.error('TinyMCE未定義');
        } else {
            console.log('✅ TinyMCE読み込み成功');
            document.getElementById('status').innerHTML = '✅ TinyMCE読み込み成功、初期化中...';
            
            tinymce.init({
                selector: '#editor',
                height: 400,
                menubar: false,
                plugins: ['lists', 'link', 'paste'],
                toolbar: 'undo redo | bold italic | bullist numlist | link',
                paste_as_text: true,
                
                init_instance_callback: function(editor) {
                    console.log('✅ TinyMCE初期化完了');
                    document.getElementById('status').style.display = 'none';
                    
                    // Flutter側に通知
                    if (window.parent && window.parent.postMessage) {
                        window.parent.postMessage({
                            type: 'tinymce_ready',
                            data: { status: 'ready' }
                        }, '*');
                    }
                }
            }).catch(function(error) {
                console.error('TinyMCE初期化エラー:', error);
                document.getElementById('status').innerHTML = '❌ 初期化失敗: ' + error.message;
            });
        }
        
        // メッセージ受信
        window.addEventListener('message', function(event) {
            try {
                const message = typeof event.data === 'string' ? JSON.parse(event.data) : event.data;
                
                if (message.type === 'set_content' && tinymce.activeEditor) {
                    tinymce.activeEditor.setContent(message.data.html || '');
                }
            } catch (e) {
                console.error('メッセージエラー:', e);
            }
        });
    </script>
</body>
</html>