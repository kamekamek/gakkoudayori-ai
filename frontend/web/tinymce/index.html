<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ç´šé€šä¿¡ã‚¨ãƒ‡ã‚£ã‚¿ - TinyMCE</title>
    
    <!-- TinyMCE CDN (Communityç‰ˆ) -->
    <script src="https://cdn.jsdelivr.net/npm/tinymce@6.8.3/tinymce.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', 'MS PGothic', sans-serif;
            background-color: #f9f9f9;
        }
        
        .editor-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        /* å­£ç¯€ãƒ†ãƒ¼ãƒ */
        .theme-spring { --primary-color: #8ED1FC; --secondary-color: #FFB3D1; }
        .theme-summer { --primary-color: #FFD93D; --secondary-color: #6BCF7F; }
        .theme-autumn { --primary-color: #FF9234; --secondary-color: #D2691E; }
        .theme-winter { --primary-color: #87CEEB; --secondary-color: #E6E6FA; }
        
        .content-style {
            font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', 'MS PGothic', sans-serif;
            font-size: 14px;
            line-height: 1.8;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .content-style h1 {
            color: var(--primary-color, #8ED1FC);
            text-align: center;
            border-bottom: 3px solid var(--primary-color, #8ED1FC);
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        
        .content-style h2 {
            color: var(--secondary-color, #FFB3D1);
            border-left: 5px solid var(--secondary-color, #FFB3D1);
            padding-left: 15px;
            margin-top: 30px;
        }
        
        .content-style p {
            margin-bottom: 16px;
        }
        
        .content-style ul, .content-style ol {
            padding-left: 30px;
        }
        
        .content-style li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <textarea id="tinymce-editor" name="content">
            <h1>ğŸŒ¸ å­¦ç´šé€šä¿¡ ğŸŒ¸</h1>
            <p>ã“ã‚“ã«ã¡ã¯ã€ä¿è­·è€…ã®çš†æ§˜ã€‚</p>
            <p>ä»Šæ—¥ã¯ç´ æ™´ã‚‰ã—ã„ä¸€æ—¥ã§ã—ãŸã€‚å­ã©ã‚‚ãŸã¡ã®ç¬‘é¡”ãŒã¨ã¦ã‚‚å°è±¡çš„ã§ã—ãŸã€‚</p>
            
            <h2>ğŸ“š ä»Šæ—¥ã®å­¦ç¿’</h2>
            <ul>
                <li>å›½èªï¼šæ¼¢å­—ã®ç·´ç¿’ã‚’ã—ã¾ã—ãŸ</li>
                <li>ç®—æ•°ï¼šã‹ã‘ç®—ã®åŸºç¤ã‚’å­¦ã³ã¾ã—ãŸ</li>
                <li>ä½“è‚²ï¼šã¿ã‚“ãªã§æ¥½ã—ãé‹å‹•ã—ã¾ã—ãŸ</li>
            </ul>
            
            <h2>ğŸ“ ãŠçŸ¥ã‚‰ã›</h2>
            <p>æ˜æ—¥ã¯é è¶³ã§ã™ã€‚ãŠå¼å½“ã®æº–å‚™ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚</p>
            
            <p style="text-align: center; margin-top: 40px; color: #666;">
                <small>ç™ºè¡Œæ—¥: 2025å¹´6æœˆ13æ—¥ | æ‹…ä»»: ã€‡ã€‡å…ˆç”Ÿ</small>
            </p>
        </textarea>
    </div>

    <script>
        let editorInstance = null;
        let currentTheme = 'spring';
        
        // ãƒ‡ãƒãƒƒã‚°æƒ…å ±
        console.log('ğŸš€ [TinyMCE] ã‚¹ã‚¯ãƒªãƒ—ãƒˆé–‹å§‹');
        console.log('ğŸ” [TinyMCE] tinymce ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ:', typeof tinymce);
        
        // TinyMCEèª­ã¿è¾¼ã¿ç¢ºèª
        if (typeof tinymce === 'undefined') {
            console.error('âŒ [TinyMCE] TinyMCEãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
            alert('TinyMCEã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
        } else {
            console.log('âœ… [TinyMCE] TinyMCEãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿å®Œäº†');
        }
        
        // TinyMCEåˆæœŸåŒ–
        tinymce.init({
            selector: '#tinymce-editor',
            height: 600,
            // language: 'ja', // ä¸€æ™‚çš„ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
            
            // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š
            plugins: [
                'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
                'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
                'insertdatetime', 'media', 'table', 'code', 'help', 'wordcount',
                'paste', 'autoresize'
            ],
            
            // ãƒ„ãƒ¼ãƒ«ãƒãƒ¼è¨­å®šï¼ˆæ—¥æœ¬èªå¯¾å¿œï¼‰
            toolbar: `
                undo redo | blocks fontsize |
                bold italic underline strikethrough | alignleft aligncenter alignright alignjustify |
                bullist numlist outdent indent | link image table |
                forecolor backcolor | removeformat | code preview
            `,
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼éè¡¨ç¤º
            menubar: false,
            
            // æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆè¨­å®š
            font_family_formats: `
                æ¸¸ã‚´ã‚·ãƒƒã‚¯ Medium=Yu Gothic Medium, YuGothic, sans-serif;
                ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ã‚·ãƒƒã‚¯=Hiragino Kaku Gothic ProN, Hiragino Sans, sans-serif;
                ãƒ¡ã‚¤ãƒªã‚ª=Meiryo, sans-serif;
                MS Pã‚´ã‚·ãƒƒã‚¯=MS PGothic, sans-serif;
                Arial=arial,helvetica,sans-serif;
                Times New Roman=times new roman,times,serif
            `,
            
            // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºè¨­å®š
            fontsize_formats: "10px 11px 12px 14px 16px 18px 20px 24px 28px 32px 36px 48px",
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¿ã‚¤ãƒ«
            content_style: `
                .content-style {
                    font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', 'MS PGothic', sans-serif;
                    font-size: 14px;
                    line-height: 1.8;
                    color: #333;
                    max-width: 800px;
                    margin: 0 auto;
                    padding: 20px;
                }
                
                .content-style h1 {
                    color: var(--primary-color, #8ED1FC);
                    text-align: center;
                    border-bottom: 3px solid var(--primary-color, #8ED1FC);
                    padding-bottom: 10px;
                    margin-bottom: 30px;
                }
                
                .content-style h2 {
                    color: var(--secondary-color, #FFB3D1);
                    border-left: 5px solid var(--secondary-color, #FFB3D1);
                    padding-left: 15px;
                    margin-top: 30px;
                }
            `,
            
            // è²¼ã‚Šä»˜ã‘è¨­å®š
            paste_as_text: false,
            paste_block_drop: false,
            paste_data_images: true,
            
            // è‡ªå‹•ãƒªã‚µã‚¤ã‚º
            autoresize_bottom_margin: 16,
            autoresize_min_height: 400,
            
            // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†æ™‚ã®å‡¦ç†
            setup: function(editor) {
                editorInstance = editor;
                
                editor.on('init', function() {
                    console.log('ğŸ“ TinyMCEã‚¨ãƒ‡ã‚£ã‚¿ãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
                    
                    // å­£ç¯€ãƒ†ãƒ¼ãƒé©ç”¨
                    applyTheme(currentTheme);
                    
                    // Flutterå´ã«åˆæœŸåŒ–å®Œäº†ã‚’é€šçŸ¥
                    if (window.parent && window.parent.postMessage) {
                        window.parent.postMessage({
                            type: 'tinymce_ready',
                            data: { status: 'ready' }
                        }, '*');
                    }
                });
                
                // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆ
                editor.on('change keyup', function() {
                    const content = editor.getContent();
                    
                    // Flutterå´ã«HTMLå¤‰æ›´ã‚’é€šçŸ¥
                    if (window.parent && window.parent.postMessage) {
                        window.parent.postMessage({
                            type: 'content_changed',
                            data: { html: content }
                        }, '*');
                    }
                });
            },
            
            // åˆæœŸè¨­å®š
            init_instance_callback: function(editor) {
                console.log('âœ… TinyMCEã‚¨ãƒ‡ã‚£ã‚¿ãŒå®Œå…¨ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
            }
        }).then(function(editors) {
            console.log('ğŸ¯ [TinyMCE] åˆæœŸåŒ–æˆåŠŸ:', editors.length, 'ã‚¨ãƒ‡ã‚£ã‚¿');
        }).catch(function(error) {
            console.error('ğŸ’¥ [TinyMCE] åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
            alert('ã‚¨ãƒ‡ã‚£ã‚¿ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        });
        
        // å­£ç¯€ãƒ†ãƒ¼ãƒé©ç”¨é–¢æ•°
        function applyTheme(theme) {
            currentTheme = theme;
            document.body.className = `theme-${theme}`;
            
            // ã‚¨ãƒ‡ã‚£ã‚¿å†…ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã‚‚ãƒ†ãƒ¼ãƒã‚¯ãƒ©ã‚¹é©ç”¨
            if (editorInstance && editorInstance.getBody) {
                const editorBody = editorInstance.getBody();
                if (editorBody) {
                    editorBody.className = `content-style theme-${theme}`;
                }
            }
        }
        
        // Flutterå´ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡
        window.addEventListener('message', function(event) {
            try {
                const message = typeof event.data === 'string' ? JSON.parse(event.data) : event.data;
                
                switch (message.type) {
                    case 'set_content':
                        if (editorInstance && message.data && message.data.html) {
                            editorInstance.setContent(message.data.html);
                        }
                        break;
                        
                    case 'get_content':
                        if (editorInstance) {
                            const content = editorInstance.getContent();
                            window.parent.postMessage({
                                type: 'content_response',
                                data: { html: content }
                            }, '*');
                        }
                        break;
                        
                    case 'set_theme':
                        if (message.data && message.data.theme) {
                            applyTheme(message.data.theme);
                        }
                        break;
                        
                    case 'insert_text':
                        if (editorInstance && message.data && message.data.text) {
                            editorInstance.insertContent(message.data.text);
                        }
                        break;
                }
            } catch (error) {
                console.error('âŒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
            }
        });
        
        // ã‚¨ãƒ‡ã‚£ã‚¿ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
        function focusEditor() {
            if (editorInstance) {
                editorInstance.focus();
            }
        }
        
        // ã‚¨ãƒ‡ã‚£ã‚¿ã®å†…å®¹ã‚’ã‚¯ãƒªã‚¢
        function clearEditor() {
            if (editorInstance) {
                editorInstance.setContent('');
            }
        }
        
        // ã‚¨ãƒ‡ã‚£ã‚¿ã®èª­ã¿å–ã‚Šå°‚ç”¨åˆ‡ã‚Šæ›¿ãˆ
        function setReadOnly(readOnly) {
            if (editorInstance) {
                editorInstance.setMode(readOnly ? 'readonly' : 'design');
            }
        }
    </script>
</body>
</html>