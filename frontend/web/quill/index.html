<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å­¦ç´šé€šä¿¡ã‚¨ãƒ‡ã‚£ã‚¿</title>
  
  <!-- Quill.js CSS -->
  <link href="https://cdn.quilljs.com/2.0.0/quill.snow.css" rel="stylesheet">
  
  <!-- å­£ç¯€ãƒ†ãƒ¼ãƒç”¨ã‚«ã‚¹ã‚¿ãƒ CSS -->
  <link href="styles.css" rel="stylesheet">
  
  <style>
    body {
      margin: 0;
      padding: 16px;
      font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
    }
    
    #editor-container {
      height: 100%;
      min-height: 400px;
    }
    
    .ql-editor {
      font-size: 16px;
      line-height: 1.6;
    }
    
    /* å­£ç¯€ãƒ†ãƒ¼ãƒé©ç”¨ */
    .theme-spring .ql-editor { background-color: #f8f9fa; color: #343a40; }
    .theme-summer .ql-editor { background-color: #f1f8ff; color: #1a1c20; }
    .theme-autumn .ql-editor { background-color: #fff9db; color: #2b2a29; }
    .theme-winter .ql-editor { background-color: #f8f9fa; color: #1a1c20; }
    
    /* ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º */
    .custom-toolbar {
      margin-bottom: 8px;
      padding: 4px;
      border-radius: 4px;
      background-color: #f1f3f5;
    }
    
    .custom-toolbar button {
      background: none;
      border: none;
      padding: 4px 8px;
      margin: 0 2px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .custom-toolbar button:hover {
      background-color: #e9ecef;
    }
    
    .custom-toolbar .active {
      background-color: #dee2e6;
    }
  </style>
</head>
<body class="theme-spring">
  <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ -->
  <div class="custom-toolbar">
    <button id="btn-season-spring" class="active" title="æ˜¥ãƒ†ãƒ¼ãƒ">ğŸŒ¸ æ˜¥</button>
    <button id="btn-season-summer" title="å¤ãƒ†ãƒ¼ãƒ">â˜€ï¸ å¤</button>
    <button id="btn-season-autumn" title="ç§‹ãƒ†ãƒ¼ãƒ">ğŸ ç§‹</button>
    <button id="btn-season-winter" title="å†¬ãƒ†ãƒ¼ãƒ">â„ï¸ å†¬</button>
  </div>

  <!-- Quillã‚¨ãƒ‡ã‚£ã‚¿ã‚³ãƒ³ãƒ†ãƒŠ -->
  <div id="editor-container"></div>

  <!-- Quill.js Script -->
  <script src="https://cdn.quilljs.com/2.0.0/quill.min.js"></script>
  
  <script>
    // Quill ã‚¨ãƒ‡ã‚£ã‚¿åˆæœŸåŒ–
    const quill = new Quill('#editor-container', {
      theme: 'snow',
      placeholder: 'å­¦ç´šé€šä¿¡ã®å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline', 'strike'],
          [{ 'header': 1 }, { 'header': 2 }, { 'header': 3 }],
          [{ 'list': 'ordered' }, { 'list': 'bullet' }],
          [{ 'color': [] }, { 'background': [] }],
          ['image', 'link'],
          ['clean']
        ]
      }
    });
    
    // å­£ç¯€ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
    document.getElementById('btn-season-spring').addEventListener('click', () => changeSeason('spring'));
    document.getElementById('btn-season-summer').addEventListener('click', () => changeSeason('summer'));
    document.getElementById('btn-season-autumn').addEventListener('click', () => changeSeason('autumn'));
    document.getElementById('btn-season-winter').addEventListener('click', () => changeSeason('winter'));
    
    // å­£ç¯€ãƒ†ãƒ¼ãƒå¤‰æ›´é–¢æ•°
    function changeSeason(season) {
      // ãƒœãƒ‡ã‚£ã®ã‚¯ãƒ©ã‚¹ã‚’å¤‰æ›´
      document.body.className = '';
      document.body.classList.add('theme-' + season);
      
      // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
      document.querySelectorAll('.custom-toolbar button').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById('btn-season-' + season).classList.add('active');
      
      // Flutterå´ã«é€šçŸ¥ï¼ˆFlutterã®JavaScriptChannelãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
      if (window.flutterChannel) {
        window.flutterChannel.postMessage(JSON.stringify({
          type: 'seasonChanged',
          season: season
        }));
      }
    }
    
    // Flutterã¨ã®JavaScripté€šä¿¡ãƒ–ãƒªãƒƒã‚¸
    window.addEventListener('flutterInAppWebViewPlatformReady', function(event) {
      // Flutter -> JS é€šä¿¡ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
      
      // ãƒ‡ãƒ«ã‚¿ã®å–å¾—ã¨è¨­å®š
      window.flutter_inappwebview.callHandler('getDelta')
        .then(function(delta) {
          if (delta) {
            quill.setContents(JSON.parse(delta));
          }
        });
      
      // å†…å®¹å¤‰æ›´æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ
      quill.on('text-change', function() {
        const delta = JSON.stringify(quill.getContents());
        const html = quill.root.innerHTML;
        window.flutter_inappwebview.callHandler('contentChanged', delta, html);
      });
      
      // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æŒ¿å…¥ãƒ¡ã‚½ãƒƒãƒ‰
      window.insertContent = function(content, index) {
        if (index === undefined) {
          index = quill.getSelection() ? quill.getSelection().index : 0;
        }
        quill.insertText(index, content);
      };
      
      // HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„æŒ¿å…¥ï¼ˆãƒªãƒƒãƒãƒ†ã‚­ã‚¹ãƒˆï¼‰
      window.insertHTML = function(html, index) {
        if (index === undefined) {
          index = quill.getSelection() ? quill.getSelection().index : 0;
        }
        const delta = quill.clipboard.convert(html);
        quill.updateContents(delta);
      };
      
      // é¸æŠãƒ†ã‚­ã‚¹ãƒˆå–å¾—
      window.getSelectedText = function() {
        const selection = quill.getSelection();
        if (selection) {
          return quill.getText(selection.index, selection.length);
        }
        return '';
      };
      
      // æº–å‚™å®Œäº†é€šçŸ¥
      window.flutter_inappwebview.callHandler('editorReady');
    });
  </script>
</body>
</html> 