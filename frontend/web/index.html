<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="å­¦æ ¡ã ã‚ˆã‚ŠAI - éŸ³å£°å…¥åŠ›ã§å­¦ç´šé€šä¿¡ã‚’è‡ªå‹•ç”Ÿæˆ">
  
  <!-- Improve touch responsiveness for mobile -->
  <style>
    body {
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      overflow-x: hidden;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    
    /* Fix iOS Safari touch issues */
    *, *:before, *:after {
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    
    /* Ensure scrollable areas work properly */
    .scrollable {
      -webkit-overflow-scrolling: touch;
      /* overflow-scrolling is deprecated, modern browsers handle smooth scrolling automatically */
    }
    
    /* Button touch optimization */
    button, .button, [role="button"] {
      touch-action: manipulation !important;
      cursor: pointer;
      -webkit-tap-highlight-color: rgba(0,0,0,0.1);
    }
    
    /* Flutter web specific fixes */
    flt-glass-pane {
      touch-action: manipulation;
    }
    
    /* Fix Flutter modal dialog overlay issue */
    .flt-glass-pane {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      width: 100% !important;
      height: 100% !important;
      pointer-events: none !important; /* èƒŒæ™¯ã¯ã‚¯ãƒªãƒƒã‚¯ç„¡åŠ¹ */
    }
    
    /* Ensure dialogs are centered and clickable */
    flt-scene-host {
      position: relative;
      z-index: 1;
      pointer-events: auto !important;
    }
    
    /* Fix overlay positioning - å®Œå…¨ã«ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç„¡åŠ¹åŒ– */
    flt-semantics-placeholder {
      position: fixed !important;
      inset: 0 !important;
      pointer-events: none !important;
    }
    
    /* ãƒ¢ãƒ¼ãƒ€ãƒ«èƒŒæ™¯ã®ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç„¡åŠ¹åŒ– */
    flt-glass-pane * {
      pointer-events: none !important;
    }
    
    /* ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã¿ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’æœ‰åŠ¹åŒ– */
    flt-semantics[role="dialog"] * {
      pointer-events: auto !important;
    }
    
    /* Ensure dialog backdrop covers entire screen */
    .cdk-overlay-backdrop,
    .modal-backdrop {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      width: 100% !important;
      height: 100% !important;
      z-index: 1040 !important;
    }
    
    /* Fix Flutter dialog button interactions */
    flt-semantics[role="dialog"] {
      pointer-events: auto !important;
      z-index: 1050 !important;
    }
    
    flt-semantics[role="button"],
    flt-semantics button {
      pointer-events: auto !important;
      z-index: 1051 !important;
      cursor: pointer !important;
    }
    
    /* Ensure all clickable elements are responsive */
    [role="button"],
    button,
    .btn,
    .button {
      pointer-events: auto !important;
      touch-action: manipulation !important;
      cursor: pointer !important;
      z-index: 1051 !important;
    }
    
    /* Fix Flutter canvas elements blocking interactions */
    flt-canvas-container {
      pointer-events: none !important;
    }
    
    flt-canvas-container canvas {
      pointer-events: none !important;
    }
    
    /* Allow interactions only on interactive elements */
    flt-semantics {
      pointer-events: auto !important;
    }
    
    /* Prevent text selection on mobile */
    .mobile-no-select {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
  </style>

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="å­¦æ ¡ã ã‚ˆã‚ŠAI">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>
  
  <title>å­¦æ ¡ã ã‚ˆã‚ŠAI</title>
  <link rel="manifest" href="manifest.json">
  
  <!-- Google Sign-In Client ID (è¦è¨­å®š) -->
  <meta name="google-signin-client_id" content="944053509139-2n9trkb7l7ijoonb8nlgn02923sbf5a3.apps.googleusercontent.com">
  
  <!-- Google Identity Services (GIS) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  
  <!-- Phase R2: éŸ³å£°éŒ²éŸ³æ©Ÿèƒ½ -->
  <script src="audio.js"></script>
</head>
<body style="background-color: #f5f5f5; margin: 0; padding: 0;">
  <!-- Flutter Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ -->
  <script src="flutter_bootstrap.js" async></script>
  
  <!-- Phase R2: Web Audio APIçµ±åˆäºˆå®šåœ° -->
  <script>
    // Phase R2ã§éŸ³å£°éŒ²éŸ³æ©Ÿèƒ½ã‚’å®Ÿè£…äºˆå®š
    console.log('Phase R1: åŸºæœ¬HTMLæ§‹æˆå®Œäº†');
    
    // Flutter Web dialog button fix
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Setting up Flutter Web button fixes...');
      
      // å®šæœŸçš„ã«ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ä¿®æ­£
      function fixButtonInteractions() {
        // ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³è¦ç´ ã‚’å¯¾è±¡ã«ï¼ˆå†èªè¨¼ãƒœã‚¿ãƒ³ã‚‚å«ã‚€ï¼‰
        const buttons = document.querySelectorAll('flt-semantics[role="button"], button, [role="button"], .btn, [type="button"], flt-semantics');
        buttons.forEach(button => {
          // å†èªè¨¼ãƒœã‚¿ãƒ³ã®ç‰¹åˆ¥å‡¦ç†
          if (button.textContent && button.textContent.includes('å†èªè¨¼')) {
            console.log('å†èªè¨¼ãƒœã‚¿ãƒ³ã‚’ç™ºè¦‹:', button);
            button.style.pointerEvents = 'auto !important';
            button.style.cursor = 'pointer !important';
            button.style.zIndex = '9999 !important';
            button.style.position = 'relative !important';
          }
          
          if (button.style.pointerEvents === 'none') {
            button.style.pointerEvents = 'auto';
          }
          if (!button.style.cursor) {
            button.style.cursor = 'pointer';
          }
          if (!button.style.zIndex || parseInt(button.style.zIndex) < 1050) {
            button.style.zIndex = '1051';
          }
          
          // å¼·åˆ¶çš„ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
          if (!button.hasAttribute('data-click-fixed')) {
            button.addEventListener('click', function(e) {
              console.log('Button clicked:', button, 'Text:', button.textContent);
              if (button.textContent && button.textContent.includes('å†èªè¨¼')) {
                console.log('å†èªè¨¼ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ!');
              }
              // e.stopPropagation(); // ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ä¼æ’­ã‚’è¨±å¯
            }, true);
            button.setAttribute('data-click-fixed', 'true');
          }
        });
        
        // Canvas elements should not block interactions
        const canvases = document.querySelectorAll('flt-canvas-container canvas, canvas');
        canvases.forEach(canvas => {
          canvas.style.pointerEvents = 'none';
        });
        
        // Dialog elements - ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¨ãã®å­è¦ç´ ã‚’å¼·åˆ¶çš„ã«æœ‰åŠ¹åŒ–
        const dialogs = document.querySelectorAll('flt-semantics[role="dialog"]');
        dialogs.forEach(dialog => {
          dialog.style.pointerEvents = 'auto !important';
          dialog.style.zIndex = '1050';
          
          // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°å†…ã®ã™ã¹ã¦ã®è¦ç´ ã‚’æœ‰åŠ¹åŒ–
          const dialogChildren = dialog.querySelectorAll('*');
          dialogChildren.forEach(child => {
            child.style.pointerEvents = 'auto !important';
          });
        });
        
        // Flutter glass pane ã®ç„¡åŠ¹åŒ–
        const glassPanes = document.querySelectorAll('flt-glass-pane, .flt-glass-pane');
        glassPanes.forEach(pane => {
          pane.style.pointerEvents = 'none !important';
        });
        
        // å…¨ã¦ã®flt-semanticsè¦ç´ ã«å¯¾ã—ã¦ã‚¯ãƒªãƒƒã‚¯å‡¦ç†ã‚’æœ‰åŠ¹åŒ–
        const semantics = document.querySelectorAll('flt-semantics');
        semantics.forEach(sem => {
          if (sem.getAttribute('role') || sem.closest('[role="dialog"]')) {
            sem.style.pointerEvents = 'auto !important';
          }
        });
      }
      
      // åˆå›å®Ÿè¡Œ
      fixButtonInteractions();
      
      // å®šæœŸçš„ã«å®Ÿè¡Œï¼ˆæ–°ã—ã„ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚ŒãŸæ™‚ã®ãŸã‚ï¼‰
      setInterval(fixButtonInteractions, 1000);
      
      // MutationObserver ã§ DOM ã®å¤‰æ›´ã‚’ç›£è¦–
      const observer = new MutationObserver(function(mutations) {
        let shouldFix = false;
        mutations.forEach(function(mutation) {
          if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
            shouldFix = true;
          }
        });
        if (shouldFix) {
          setTimeout(fixButtonInteractions, 100);
        }
      });
      
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
      
      // ç·Šæ€¥ä¿®æ­£: å…¨ç”»é¢ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ‡ãƒãƒƒã‚° + å³åŠåˆ†ãƒ–ãƒ­ãƒƒã‚¯å¯¾ç­–
      document.addEventListener('click', function(e) {
        console.log('Click event:', e.target, e.target.tagName, e.target.getAttribute('role'), 'Text:', e.target.textContent, 'Position:', e.clientX, e.clientY);
        
        // å³åŠåˆ†ã‚¯ãƒªãƒƒã‚¯å•é¡Œã®ãƒ‡ãƒãƒƒã‚°
        if (e.clientX > window.innerWidth / 2) {
          console.log('ğŸ”´ å³åŠåˆ†ã‚¯ãƒªãƒƒã‚¯æ¤œå‡º:', e.clientX, '>', window.innerWidth / 2);
          
          // ã‚¯ãƒªãƒƒã‚¯ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹å ´åˆã®å¼·åˆ¶å‡¦ç†
          const elementBelow = document.elementFromPoint(e.clientX, e.clientY);
          if (elementBelow && elementBelow !== e.target) {
            console.log('ğŸ”§ å®Ÿéš›ã®è¦ç´ :', elementBelow);
            elementBelow.click();
          }
        }
        
        // å†èªè¨¼ãƒœã‚¿ãƒ³ã®ç‰¹åˆ¥å‡¦ç†
        if (e.target.textContent && e.target.textContent.includes('å†èªè¨¼')) {
          console.log('ğŸ”µ å†èªè¨¼ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ¤œå‡º!');
          e.stopImmediatePropagation();
          // Flutterå†…éƒ¨ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’å¼·åˆ¶ç™ºç«
          setTimeout(() => {
            const clickEvent = new MouseEvent('click', {
              view: window,
              bubbles: true,
              cancelable: true,
              clientX: e.clientX,
              clientY: e.clientY
            });
            e.target.dispatchEvent(clickEvent);
          }, 10);
        }
        
        // Flutter semanticsè¦ç´ ã®ã‚¯ãƒªãƒƒã‚¯ã‚’å¼·åˆ¶å®Ÿè¡Œ
        if (e.target.tagName === 'FLT-SEMANTICS' && e.target.getAttribute('role') === 'button') {
          console.log('Force triggering Flutter button click');
          // Flutterå†…éƒ¨ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
          const event = new Event('click', { bubbles: true, cancelable: true });
          e.target.dispatchEvent(event);
        }
      }, true);
      
      // ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ‡ãƒãƒƒã‚°
      document.addEventListener('pointerdown', function(e) {
        console.log('Pointer down:', e.target);
        if (e.target.style.pointerEvents === 'none') {
          console.log('Pointer events disabled on:', e.target);
          e.target.style.pointerEvents = 'auto';
        }
      }, true);
    });
  </script>
</body>
</html>
